const alerts = document.querySelectorAll(".Alert");
const popups = document.querySelectorAll(".popup");
const cardsProducts = document.querySelectorAll(".card-product-v1");
if(alerts) {
    alerts.forEach(alert => {
        if (alert.getAttribute("tpClose")) {
            alert.querySelector(".img").onclick = () => {
                alert.classList.add(alert.getAttribute("tpClose"))
                setTimeout(() => {
                    alert.remove()
                },500)
            }

        }

    });
}
if(cardsProducts){
    cardsProducts.forEach(card => {
        const prodcutPictures = card.querySelectorAll(".card-product-others-image-list li");
        const productImageareadisplay = card.querySelector(".card-product-image-section img");
        prodcutPictures.forEach(prodImage => {
            prodImage.onclick = () => {
                if (!prodImage.classList.contains("selected")) {
                    card.querySelector(".selected").classList.remove("selected")
                    prodImage.classList.add("selected");
                    productImageareadisplay.src = prodImage.querySelector("img").src;
                }
            }
        })
    });
    if (this.innerWidth > 768) {
        cardsProducts.forEach(card => {
            const containerForZoom = card.querySelector(".card-product-image-container");
            const currentDisplayedImage = card.querySelector(".card-product-image-section");
            const currentDisplayedImageCli = currentDisplayedImage.getBoundingClientRect();
            currentDisplayedImage.onclick = event => {
                var mx = event.pageX;
                var my = event.pageY;
                var ix = GetElementOffset(currentDisplayedImage).left;
                var iy = GetElementOffset(currentDisplayedImage).top;
                console.log(ix + '-' + iy);
                console.log(mx + '-' + my);
            }
            currentDisplayedImage.onmouseover = e => {
                var ImageSrc = currentDisplayedImage.querySelector("img").src;
                var zoomElement = document.createElement("div");
                zoomElement.setAttribute("class","zoom")
                zoomElement.setAttribute("style","background-image: url(" + ImageSrc + "); background-size: 1200px;")
                containerForZoom.appendChild(zoomElement)
            }
            currentDisplayedImage.onmousemove = event => {
                var ImageSrc = currentDisplayedImage.querySelector("img").src;
                var mx = event.pageX;
                var my = event.pageY;
                var ix = GetElementOffset(currentDisplayedImage).left;
                var iy = GetElementOffset(currentDisplayedImage).top;
                var x = mx - (ix) + 100;
                var y = my - (iy);
                var w = currentDisplayedImageCli.width
                var h = currentDisplayedImageCli.height;
                var xp = (-x / w) * -100;
                var yp = (-y / h) * -100;
                card.querySelector(".zoom").setAttribute("style","background-image: url(" + ImageSrc + "); background-size: 700px; background-repeat: no-repeat; background-position: " + xp + "% " + yp + "%; top: " + y + "px; left: " + x + "px")
            }
            currentDisplayedImage.onmouseout = () => {
                card.querySelector(".zoom").remove();
            }
        })

    }
    function GetElementOffset(obj) {
        var curleft = curtop = 0;
        if (obj.offsetParent) {
            do {
                curleft += obj.offsetLeft;
                curtop += obj.offsetTop;
            } while (obj = obj.offsetParent);
            return { left: curleft,top: curtop }
        }
    }
}
if(popups) {
    popups.forEach(popup => {
        if (popup.querySelector(".close-popup")) {
            popup.querySelector(".close-popup").onclick = () => {
                if (popup.getAttribute("tpClose")) {
                    popup.classList.add(popup.getAttribute("tpClose"))
                }
                setTimeout(() => {
                    popup.remove()
                },500)
            }
        }

    })
}